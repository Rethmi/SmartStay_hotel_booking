<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile - SmartStay</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<link rel="stylesheet" href="../css/profile.css">
<style>
:root {
    --primary: #b76e79;   /* rosa color */
    --secondary: #D4A574;
    --accent: #F4E4BC;
    --dark: #2C1810;
    --light: #FAF7F2;
}

/* Navbar */
.navbar {
    background: #fff5f7; /* light rosa background */
    box-shadow: 0 2px 10px rgba(0,0,0,.1);
    font-size: 1.5rem;
    transition: background 0.3s ease;
}
.navbar:hover {
    background: #ffe6eb; /* darker rosy background on hover */
}
.navbar-brand {
    color: var(--primary);
    font-weight: 700;
    font-size: 2.5rem;
    display: flex;
    align-items: center;
    transition: color 0.3s ease;
}
.navbar-brand img {
    height: 60px;
    margin-right: 10px;
}
.navbar-brand:hover {
    color: #ff4d79; /* brighter rosa when hovering brand text */
}
.nav-link {
    font-weight: 500;
    color: var(--dark);
    transition: color 0.3s ease;
}
.nav-link:hover {
    color: var(--primary) !important; /* rosa hover effect */
}
.nav-link.active {
    color: var(--primary) !important;
}
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: var(--light);
            background-color: #e67190; /
        }
    
body::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(250, 247, 242, 0.6);
    z-index: 1;
}


        



.container { position: relative; z-index: 2; }
.profile-container {
    max-width: 600px;
    margin: 50px auto;
    padding: 40px;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px 0 rgba(44,24,16,0.2);
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.18);
    position: relative;
    overflow: hidden;
}
.profile-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--secondary);
}
.profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    margin: 0 auto 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: transform 0.3s ease;
}
.profile-avatar:hover { transform: scale(1.05); }
.profile-field {
    margin-bottom: 20px;
    padding: 15px;
    background-color: var(--light);
    border-radius: 8px;
    transition: all 0.3s ease;
}
.profile-field:hover { background-color: var(--secondary); transform: translateX(5px); }
.profile-label { font-weight: 600; color: var(--primary); margin-right: 10px; min-width: 80px; display: inline-block; }
.profile-value { color: var(--dark); font-weight: 400; }
.btn-primary {
    background-color: var(--primary); border-color: var(--primary);
    padding: 10px 25px; border-radius: 25px; transition: all 0.3s ease;
}
.btn-primary:hover { background-color: var(--accent); border-color: var(--accent); transform: translateY(-2px); }
.btn-logout {
    background-color: var(--dark); border-color: var(--dark);
    padding: 10px 25px; border-radius: 25px; transition: all 0.3s ease; color: white;
}
.btn-logout:hover { background-color: #6c4f3d; border-color: #6c4f3d; transform: translateY(-2px); }
h2 { color: var(--dark); font-weight: 700; letter-spacing: 1px; }</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="#">
            <img src="./assets/images/hotel1.jpg" alt="Logo" style="height:40px;">
            SmartStay Hotel Booking
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">
               <li>
                        <a href="#home" class="navbar-link" data-nav-link>home</a>
                    </li>
                    <li>
                        <a href="#" class="navbar-link" data-nav-link>about us</a>
                    </li>
                    <li>
                        <a href="#destination" class="navbar-link" data-nav-link>Stays</a>
                    </li>
                    <li>
                        <a href="#contact" class="navbar-link" data-nav-link>contact us</a>
                    </li>
                 
                <li class="nav-item"><a class="nav-link" href="profile.html">Profile</a></li>
                <li><a class="dropdown-item text-danger" href="login.html">Logout</a></li>
            </ul>
        </div>
    </div>
</nav>



<div class="container">
    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar" id="avatar"></div>
            <h2>My Profile</h2>
        </div>
        <div id="profile-content">
            <div class="profile-field">
                <span class="profile-label">Name:</span>
                <span id="user-name" class="profile-value">Loading...</span>
            </div>
            <div class="profile-field">
                <span class="profile-label">Email:</span>
                <span id="user-email" class="profile-value">Loading...</span>
            </div>
            <div class="text-center mt-4 d-flex justify-content-center gap-3">
                <button id="edit-profile" class="btn btn-primary">
                    <i class="fas fa-edit me-2"></i>Edit Profile
                </button>
                <button id="logout-btn" class="btn btn-logout">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="editProfileForm">
          <div class="mb-3">
            <label for="edit-username" class="form-label">Name</label>
            <input type="text" id="edit-username" class="form-control" required>
          </div>
          <div class="mb-3">
            <label for="edit-password" class="form-label">Password</label>
            <input type="password" id="edit-password" class="form-control">
          </div>
           
          <button type="submit" class="btn btn-primary w-100">Save Changes</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
const token = localStorage.getItem("token");

// Load profile
async function loadProfile() {
    try {
        const res = await fetch("http://localhost:8080/api/v1/profile", {
            headers: { "Authorization": `Bearer ${token}` }
        });
        if (!res.ok) throw new Error("Failed to fetch profile");
        const profile = await res.json();

        document.getElementById("user-name").textContent = profile.username;
        document.getElementById("user-email").textContent = profile.email;

        const initials = profile.username.split(" ").map(n => n[0]).join("").toUpperCase();
        document.getElementById("avatar").textContent = initials;

        document.getElementById("edit-username").value = profile.username;

    } catch (err) {
        // console.error(err);
        // Swal.fire({
        //     icon: 'error',
        //     title: 'Oops...',
        //     text: 'Failed to load profile. Please log in again.'
        // }).then(() => {
        //     window.location.href = "/login.html";
        // });
    }
}
loadProfile();

// Logout
document.getElementById("logout-btn").addEventListener("click", () => {
    localStorage.removeItem("token");
    window.location.href = "/login.html";
});

// Edit Profile Modal
const editModal = new bootstrap.Modal(document.getElementById("editProfileModal"));
document.getElementById("edit-profile").addEventListener("click", () => editModal.show());

// Submit Edit Form
document.getElementById("editProfileForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const username = document.getElementById("edit-username").value;
    const password = document.getElementById("edit-password").value;
    const confirmPassword = document.getElementById("edit-confirm-password").value;

    if (password && password !== confirmPassword) {
        Swal.fire({ icon: 'warning', title: 'Passwords do not match!' });
        return;
    }

    try {
        const res = await fetch("http://localhost:8080/api/v1/profile/update", {
            method: "PUT",
            headers: { 
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify({ username, password })
        });
        if (!res.ok) throw new Error("Failed to update profile");

        Swal.fire({ icon: 'success', title: 'Profile updated successfully!' });
        editModal.hide();

        // Update profile display immediately
        document.getElementById("user-name").textContent = username;
        const initials = username.split(" ").map(n => n[0]).join("").toUpperCase();
        document.getElementById("avatar").textContent = initials;

    } catch (err) {
        console.error(err);
        Swal.fire({ icon: 'error', title: 'Failed to update profile' });
    }
});
</script>

</body>
</html>