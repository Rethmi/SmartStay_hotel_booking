<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Hotel Booking</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="shortcut icon" href="./favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="css/hotelSearch.css">
  
  <!-- SweetAlert2 CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --primary-color: #3a86ff;
      --secondary-color: #ff9e01;
      --dark-color: #1a1a2e;
      --light-color: #f8f9fa;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f9fafb;
    }
    
    .logo-hotel {
      width: 300px;
      height: 53px;
    }

    ol,
    ul {
      padding-left: 0rem;
    }

    .see {
      padding: 8px 20px;
    }
    
    /* Header Styles */
    .header {
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
    }
    
    /* .header-top {
      background:var(--primary-color);
      padding: 10px 0;
      
    } */
    
    .header-bottom {
      /* background: var(--primary-color); */
      padding: 15px 0;
    }
    
    .helpline-box {
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .helpline-box:hover {
      color: var(--dark-color);
    }
    
    .social-link {
      color: white;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }
    
    .social-link:hover {
      color: var(--dark-color);
      transform: translateY(-3px);
    }
    
    .navbar-link {
      color: white;
      text-transform: capitalize;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .navbar-link:hover {
      color: var(--dark-color);
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background-color: #2a75ff;
      border-color:#0f0754;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .btn-secondary {
      background-color: var(--dark-color);
      border-color: var(--dark-color);
      transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
      background-color: #0f0754;
      border-color: #0f0754;
      transform: translateY(-2px);
      box-shadow:#0f0754;
    }
    
    /* Hero Section */
    .hero {
     background-image: url("../assets/images/image.png");
    background-repeat: no-repeat;
    background-size: cover;
    background-position: center;
    background-color: hsla(0, 2%, 28%, 0.7);
    background-blend-mode: overlay;
    display: grid;
    place-items: center;
    min-height: 750px;
    text-align: center;
    padding-top: 125px;
    }
     .logo-hotel {
            width: 100px;
            height: 100px;
        }
    .hero-title {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .hero-text {
      font-size: 1.2rem;
      margin-bottom: 30px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    
    /* Search Form */
    .tour-search {
      background: white;
      padding: 50px 0;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .tour-search-form {
      background: #4e85e9;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .input-label {
      font-weight: 600;
      color: var(--dark-color);
      margin-bottom: 8px;
      display: block;
    }
    
    .input-field {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    
    .input-field:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(58, 134, 255, 0.25);
    }
    
    /* Hotel Cards Container */
    .searchContainer {
      min-height: 500px;
      padding: 30px 0;
    }
    
    /* Hotel Cards */
    .hotel-card {
      border: none;
      border-radius: 15px;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
      background: white;
    }
    
    .hotel-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
    }
    
    .hotel-image {
      height: 250px;
      width: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }
    
    .hotel-card:hover .hotel-image {
      transform: scale(1.05);
    }
    
    .card-body {
      padding: 20px;
    }
    
    .card-title {
      font-weight: 700;
      color: var(--dark-color);
      margin-bottom: 10px;
      font-size: 1.4rem;
    }
    
    .hotel-location {
      color: #6c757d;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .hotel-description {
      color: #555;
      margin-bottom: 20px;
      line-height: 1.6;
    }
    
    .seeAvailability {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      border: none;
      color: white;
      padding: 12px 25px;
      border-radius: 50px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .seeAvailability:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(58, 134, 255, 0.3);
      color: white;
    }
    
    /* Rating Stars */
    .rating {
      color: #ffc107;
      margin-bottom: 10px;
    }
    
    /* No Results Message */
    .no-results {
      text-align: center;
      padding: 50px;
      color: #6c757d;
    }
    
    .no-results i {
      font-size: 4rem;
      margin-bottom: 20px;
      color: #dee2e6;
    }
    
    /* Loading Animation */
    .hotel-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 300px;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Footer Styles */
    .footer {
      background: var(--dark-color);
      color: white;
    }
    
    .footer-top {
      padding: 60px 0 30px;
    }
    
    .footer-brand img {
      max-width: 200px;
      margin-bottom: 20px;
    }
    
    .footer-text {
      color: #aaa;
      margin-bottom: 20px;
    }
    
    .contact-title {
      font-weight: 700;
      margin-bottom: 20px;
      color: white;
    }
    
    .contact-text {
      color: #aaa;
      margin-bottom: 20px;
    }
    
    .contact-item {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    
    .contact-item ion-icon {
      margin-right: 10px;
      color: var(--primary-color);
    }
    
    .contact-link {
      color: #aaa;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .contact-link:hover {
      color: var(--primary-color);
    }
    
    .footer-bottom {
      background: rgba(0, 0, 0, 0.2);
      padding: 20px 0;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .hero-title {
        font-size: 2rem;
      }
      
      .hero-text {
        font-size: 1rem;
      }
      
      .hotel-card {
        max-width: 100%;
      }
    }
  </style>
</head>

<body id="top">

  <!-- HEADER -->
  <header class="header" data-header>
    <div class="overlay" data-overlay></div>
    <div class="header-top">
      <div class="container">
        <a href="tel:+01123456790" class="helpline-box">
          <div class="icon-box">
            <ion-icon name="call-outline"></ion-icon>
          </div>
          <div class="wrapper">
            <p class="helpline-title">For Further Inquires :</p>
            <p class="helpline-number">+01 (123) 4567 90</p>
          </div>
        </a>
        <a href="#" class="logo logo-hotel">
          <img src="./assets/images/HotelLogo.png" alt="Hotel Logo" class="logo-hotel">
        </a>
        <div class="header-btn-group">
          <button class="search-btn" aria-label="Search">
            <ion-icon name="search"></ion-icon>
          </button>
          <button class="nav-open-btn" aria-label="Open Menu" data-nav-open-btn>
            <ion-icon name="menu-outline"></ion-icon>
          </button>
        </div>
      </div>
    </div>

    <div class="header-bottom">
      <div class="container">
        <ul class="social-list">
          <li><a href="#" class="social-link"><ion-icon name="logo-facebook"></ion-icon></a></li>
          <li><a href="#" class="social-link"><ion-icon name="logo-twitter"></ion-icon></a></li>
          <li><a href="#" class="social-link"><ion-icon name="logo-youtube"></ion-icon></a></li>
        </ul>

        <nav class="navbar" data-navbar>
          <div class="navbar-top">
            <a href="#" class="logo">
              <img src="./assets/images/colombo.jpeg" alt="Logo">
            </a>
            <button class="nav-close-btn" aria-label="Close Menu" data-nav-close-btn>
              <ion-icon name="close-outline"></ion-icon>
            </button>
          </div>
          <ul class="navbar-list">
            <li><a href="CustomerDashboard.html" class="navbar-link">Home</a></li>
            <li><a href="#" class="navbar-link">About Us</a></li>
            <li><a href="#destination" class="navbar-link">Stays</a></li>
            <li><a href="#contact" class="navbar-link">Contact Us</a></li>
          </ul>
        </nav>

        <button class="btn btn-primary" onclick="logout()">Log Out</button>
      </div>
    </div>
  </header>

  <main>
    <article>
      <!-- HERO -->
      <section class="hero" id="home">
        <div class="container">
          <h2 class="h1 hero-title">Discover Your Perfect Stay</h2>
          <p class="hero-text">
            Explore the finest hotels across Sri Lanka. From beachfront resorts to mountain retreats, 
            find the perfect accommodation for your next adventure.
          </p>
          <div class="btn-group">
            <button class="btn btn-primary">Learn more</button>
            <button class="btn btn-secondary" onclick="window.location.href='CustomerDashboard.html'">
              <i class="fas fa-arrow-left me-2"></i>Back to Home
            </button>
          </div>
        </div>
      </section>

      <!-- TOUR SEARCH -->
      <section class="tour-search">
        <div class="container">
          <form action="" class="tour-search-form">
            <div class="input-wrapper">
              <label for="destination" class="input-label">Search Destination*</label>
              <input type="text" id="destination" placeholder="Enter Destination" required class="input-field">
            </div>
            <div class="input-wrapper">
              <label for="people" class="input-label">Room Type*</label>
              <select id="people" required class="input-field">
                <option value="single">Single</option>
                <option value="double" selected>Double</option>
                <option value="suite">Suite</option>
              </select>
            </div>
            <div class="input-wrapper">
              <label for="checkin" class="input-label">Check-in Date*</label>
              <input type="date" id="checkin" required class="input-field">
            </div>
            <div class="input-wrapper">
              <label for="checkout" class="input-label">Check-out Date*</label>
              <input type="date" id="checkout" required class="input-field">
            </div>
            <button type="submit" class="btn btn-secondary" id="search_btn">
              <i class="fas fa-search me-2"></i>Search now
            </button>
          </form>
        </div>
      </section>

      <!-- HOTEL LIST -->
      <div class="searchContainer">
        <div class="container">
          <h2 class="text-center mb-5">Available Hotels</h2>
          <div class="row g-4 justify-content-center" id="hotelsContainer"></div>
        </div>
      </div>

      <!-- CTA -->
      <section class="cta" id="contact">
        <div class="container">
          <div class="cta-content">
            <p class="section-subtitle">Call To Action</p>
            <h2 class="h2 section-title">Ready For Unforgettable Travel. Remember Us!</h2>
            <p class="section-text">Enjoy seamless hotel bookings with Smart Hotel Booking. Your comfort, our priority.</p>
          </div>
          <button class="btn btn-secondary">Contact Us!</button>
        </div>
      </section>
    </article>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-top">
      <div class="container">
        <div class="footer-brand">
          <a href="#" class="logo">
            <img src="./assets/images/HotelLogo.png" alt="Hotel Logo">
          </a>
          <p class="footer-text">
            Smart Hotel Booking brings you the best hotels in Sri Lanka with an effortless booking process.
          </p>
        </div>

        <div class="footer-contact">
          <h4 class="contact-title">Contact Us</h4>
          <p class="contact-text">Feel free to contact and reach us!</p>
          <ul>
            <li class="contact-item"><ion-icon name="call-outline"></ion-icon><a href="tel:+01123456790"
                class="contact-link">+01 (123) 4567 90</a></li>
            <li class="contact-item"><ion-icon name="mail-outline"></ion-icon><a href="mailto:SmartHotelBooking@gmail.com"
                class="contact-link">SmartHotelBooking@gmail.com</a></li>
            <li class="contact-item"><ion-icon name="location-outline"></ion-icon><address>Sri Lanka</address></li>
          </ul>
        </div>

        <div class="footer-form">
          <p class="formm-text">Subscribe to our newsletter for updates!</p>
          <form action="" class="form-wrapper">
            <input type="email" class="input-field" placeholder="Enter Your Email" required>
            <button type="submit" class="btn btn-secondary">Subscribe</button>
          </form>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container">
        <p class="copyright">&copy; 2025 <a href="">Smart Hotel Booking</a>. All rights reserved.</p>
        <ul class="footer-bottom-list">
          <li><a href="#" class="footer-bottom-link">Privacy Policy</a></li>
          <li><a href="#" class="footer-bottom-link">Terms & Conditions</a></li>
          <li><a href="#" class="footer-bottom-link">FAQ</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <a href="#top" class="go-top" data-go-top><ion-icon name="chevron-up-outline"></ion-icon></a>

  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    crossorigin="anonymous"></script>
  
  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

 <script>
  // SweetAlert notifications
  function showAlert(icon, title, text) {
    Swal.fire({
      icon: icon,
      title: title,
      text: text,
      timer: 3000,
      showConfirmButton: false
    });
  }

  $(document).ready(function () {
    let token = localStorage.getItem("jwtToken");
    if (!token) {
      showAlert('error', 'Access Denied', 'Please login first');
      setTimeout(() => {
        window.location.href = "login.html";
      }, 1500);
      return;
    }

    // Load saved search parameters if they exist
    const savedDestination = localStorage.getItem("destination");
    const savedCheckin = localStorage.getItem("checkin");
    const savedCheckout = localStorage.getItem("checkout");
    const savedPeople = localStorage.getItem("people");

    if (savedDestination) $("#destination").val(savedDestination);
    if (savedCheckin) $("#checkin").val(savedCheckin);
    if (savedCheckout) $("#checkout").val(savedCheckout);
    if (savedPeople) $("#people").val(savedPeople);

    // If we have search parameters, perform the search
    if (savedDestination || savedCheckin || savedCheckout || savedPeople) {
      fetchHotels();
    }

    $(".tour-search-form").submit(function (e) {
      e.preventDefault();

      // Save search parameters to localStorage
      localStorage.setItem("destination", $("#destination").val());
      localStorage.setItem("checkin", $("#checkin").val());
      localStorage.setItem("checkout", $("#checkout").val());
      localStorage.setItem("people", $("#people").val());

      fetchHotels();
    });
  });

  function fetchHotels() {
    const people = $("#people").val();
    const checkin = $("#checkin").val();
    const checkout = $("#checkout").val();
    const destination = $("#destination").val()?.trim().toLowerCase() || "";

    if (new Date(checkin) >= new Date(checkout)) {
      showAlert('warning', 'Invalid Dates', 'Check-out date must be after check-in date');
      return;
    }

    $("#hotelsContainer").html(`
      <div class="col-12 hotel-loading">
        <div class="loading-spinner"></div>
      </div>
    `);

    $.ajax({
      url: "http://localhost:8080/api/v1/hotels/all",
      method: "GET",
      headers: { "Authorization": `Bearer ${localStorage.getItem("jwtToken")}` },
      success: function (res) {
        // Clear loading message
        $("#hotelsContainer").empty();

        // hotels might be in res.data or directly in res
        const hotels = res.data || res;

        if (!hotels || hotels.length === 0) {
          $("#hotelsContainer").html(`
            <div class="col-12 no-results">
              <i class="fas fa-hotel"></i>
              <h3>No Hotels Found</h3>
              <p>We couldn't find any hotels in our database.</p>
            </div>
          `);
          return;
        }

        // Filter by destination
        let filteredHotels = hotels.filter(h =>
          h.location?.toLowerCase().includes(destination.toLowerCase())
        );

        if (filteredHotels.length === 0) {
          $("#hotelsContainer").html(`
            <div class="col-12 no-results">
              <i class="fas fa-search"></i>
              <h3>No Hotels Match Your Search</h3>
              <p>Try adjusting your search criteria or browse all hotels.</p>
              <button class="btn btn-primary mt-3" onclick="$('#destination').val(''); fetchHotels();">
                Show All Hotels
              </button>
            </div>
          `);
          return;
        }

        // Render hotels
        renderHotels(filteredHotels, people, checkin, checkout);
        
        showAlert('success', 'Search Complete', `Found ${filteredHotels.length} hotels matching your criteria`);
      },
      error: function () {
        $("#hotelsContainer").html(`
          <div class="col-12 no-results">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Failed to Load Hotels</h3>
            <p>Please try again later or contact support if the problem persists.</p>
          </div>
        `);
        showAlert('error', 'Error', 'Failed to load hotels. Please try again.');
      }
    });
  }

  function renderHotels(hotels, roomType, checkin, checkout) {
    const hotelsContainer = $("#hotelsContainer");
    hotelsContainer.empty();

    const fallbackImage = './assets/images/colombo.jpeg';

    hotels.forEach(hotel => {
      // Build full image URL if missing or invalid
      let imageUrl = fallbackImage;
      if (hotel.image) {
        if (hotel.image.startsWith('http')) {
          imageUrl = hotel.image;
        } else {
          imageUrl = `./assets/images/colombo.jpeg`;
        }
      }

      // Generate random rating for demo purposes
      const rating = Math.floor(Math.random() * 2) + 4; // 4 or 5 stars
      
      const hotelCard = `
        <div class="col-lg-6 col-xl-4">
          <div class="hotel-card">
            <img src="${imageUrl}" 
                 class="hotel-image" 
                 alt="${hotel.name}"
                 onerror="this.onerror=null; this.src='${fallbackImage}'">
            <div class="card-body">
              <h5 class="card-title">${hotel.name}</h5>
              <div class="rating">
                ${'<i class="fas fa-star"></i>'.repeat(rating)}
                ${'<i class="far fa-star"></i>'.repeat(5 - rating)}
                <span class="ms-2">${rating}.0</span>
              </div>
              <p class="hotel-location">
                <i class="fas fa-map-marker-alt"></i> ${hotel.location}
              </p>
              <p class="hotel-description">${hotel.description || "Experience luxury and comfort at this beautiful property."}</p>
              <button type="button" class="btn seeAvailability" 
                      data-hotel-id="${hotel.id}" 
                      data-hotel-name="${hotel.name}"
                      data-hotel-location="${hotel.location}"
                      data-hotel-description="${hotel.description}"
                      data-hotel-image="${hotel.image}"
                      data-room-type="${roomType}"
                      data-checkin="${checkin}"
                      data-checkout="${checkout}">
                <i class="fas fa-calendar-check me-2"></i>Check Availability
              </button>
            </div>
          </div>
        </div>
      `;

      hotelsContainer.append(hotelCard);
    });
  }

  // Click handler for "Check Availability" button
  $(document).on("click", ".seeAvailability", function () {
    // Store all hotel data in localStorage
    const hotelData = {
      id: $(this).data("hotel-id"),
      name: $(this).data("hotel-name"),
      location: $(this).data("hotel-location"),
      description: $(this).data("hotel-description"),
      image: $(this).data("hotel-image"),
      roomType: $(this).data("room-type"),
      checkin: $(this).data("checkin"),
      checkout: $(this).data("checkout")
    };

    localStorage.setItem("selectedHotel", JSON.stringify(hotelData));
    
    showAlert('info', 'Redirecting', `Taking you to ${hotelData.name} details`);

    // Navigate to hotel details page after a brief delay
    setTimeout(() => {
      window.location.href = "Hotel.html";
    }, 1500);
  });

  function logout() {
    Swal.fire({
      title: 'Logout',
      text: 'Are you sure you want to logout?',
      icon: 'question',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, logout!'
    }).then((result) => {
      if (result.isConfirmed) {
        // Clear all stored data related to user session & search
        localStorage.removeItem("jwtToken");
        localStorage.removeItem("checkin");
        localStorage.removeItem("checkout");
        localStorage.removeItem("destination");
        localStorage.removeItem("email");
        localStorage.removeItem("people");
        localStorage.removeItem("role");
        localStorage.removeItem("selectedHotel");

        showAlert('success', 'Logged Out', 'You have been successfully logged out');
        
        setTimeout(() => {
          window.location.href = "Login.html";
        }, 1500);
      }
    });
  }
</script>

</body>
</html>